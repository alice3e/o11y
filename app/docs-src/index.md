# Добро пожаловать в проект "Product Store"

Это бэкенд-сервис для имитации работы интернет-магазина, разработанный в рамках домашнего задания по теме **Observability (o11y)**.

## Реализованная функциональность

- ✅ **Бэкенд на FastAPI** с поддержкой REST API
- ✅ **База данных Cassandra** для хранения информации о товарах
- ✅ **API для управления товарами** (создание, чтение, обновление, удаление)
- ✅ **Сервис корзины** для добавления товаров и оформления заказов
- ✅ **Сервис заказов** для управления заказами и отслеживания их статуса
- ✅ **Сервис пользователей** для регистрации, аутентификации и управления профилями
- ✅ **JWT-аутентификация** для безопасного взаимодействия между сервисами
- ✅ **Автоматическая документация API** через Swagger UI
- ✅ **Контейнеризация** с использованием Docker и Docker Compose

## Микросервисная архитектура

Проект построен на основе микросервисной архитектуры, где каждый сервис отвечает за свою область функциональности:

1. **Backend Service** - управление товарами и работа с базой данных
2. **Cart Service** - управление корзиной пользователя
3. **Order Service** - управление заказами и их статусами
4. **User Service** - управление пользователями и их профилями
5. **Nginx** - маршрутизация запросов между сервисами
6. **Documentation** - документация проекта

## Особенности реализации

- **Асинхронное взаимодействие** между сервисами с использованием библиотеки HTTPX
- **JWT токены** для аутентификации и авторизации пользователей
- **Поддержка нескольких методов идентификации пользователя** (Authorization и X-User-ID заголовки)
- **Фоновые задачи** для асинхронной обработки операций
- **Обработка ошибок** и корректная передача статусов между сервисами
- **Nginx как обратный прокси** для маршрутизации запросов и передачи заголовков

## Ключевые ссылки

* **Интерактивный справочник API (Swagger UI)**: **[Перейти к API](/api/swagger)**
* **Документация по архитектуре**: **[Архитектура](/architecture)**
* **Документация по микросервисам**: **[Микросервисы](/microservices)**
* **Документация по базе данных**: **[База данных](/database)**
* **Документация по API**: **[API](/api_docs)**
* **План дальнейших работ**: **[План](/future_plans)**
* **Инструкция по воспроизведению алертов**: **[Алерты](/reproduce_alerts)**

## Как запустить проект

1. Убедитесь, что у вас установлен Docker и Docker Compose.
2. Склонируйте репозиторий.
3. Выполните команду в **корневой директории** проекта:

   ```bash
   docker-compose -f infra/docker-compose.yml up --build
   ```

4. После запуска всех сервисов, API будет доступен по адресу:
   ```
   http://localhost/api/
   ```

5. Документация доступна по адресу:
   ```
   http://localhost/docs/
   ```

## Тестирование взаимодействия микросервисов

Для проверки взаимодействия всех микросервисов можно использовать скрипт `test_all_microservices.sh`:

```bash
./test_all_microservices.sh
```

Этот скрипт выполняет следующие действия:
1. Проверяет доступность всех сервисов
2. Регистрирует нового пользователя и получает JWT токен
3. Добавляет товары в базу данных
4. Добавляет товары в корзину
5. Оформляет заказ из корзины
6. Проверяет статус заказа и список заказов пользователя

Скрипт демонстрирует корректную работу всех микросервисов и их взаимодействие, включая передачу аутентификационных заголовков между сервисами.

## Примеры использования API

### Регистрация пользователя

```bash
curl -X POST http://localhost/user-api/users/register \
  -H "Content-Type: application/json" \
  -d '{"username": "newuser", "full_name": "New User", "phone": "+7 (999) 123-45-67", "password": "password123"}'
```

### Аутентификация и получение токена

```bash
curl -X POST http://localhost/user-api/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=testuser&password=password123"
```

### Добавление товара в корзину

```bash
curl -X POST http://localhost/cart-api/cart/items \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer {token}" \
  -d '{"product_id": "f767c2cb-215d-469e-a3be-c6e40a6cf47f", "quantity": 2}'
```

### Оформление заказа из корзины

```bash
curl -X POST http://localhost/user-api/users/me/orders \
  -H "Authorization: Bearer {token}"
```
