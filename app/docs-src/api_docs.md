<!-- omit in toc -->
# API Documentation

## Обзор API

API нашей системы разделен на несколько микросервисов, каждый из которых отвечает за определенную функциональность:

- **Backend API** (`/api/*`) - основной API для работы с данными о товарах и категориях
- **Cart API** (`/cart-api/*`) - API для работы с корзиной
- **Order API** (`/order-api/*`) - API для работы с заказами
- **User API** (`/user-api/*`) - API для работы с пользователями

Все микросервисы доступны через единую точку входа по базовому URL: `http://localhost/`.

## Единый Swagger UI

Для удобства работы с API всех микросервисов, мы предоставляем единый Swagger UI, который объединяет документацию по всем API эндпоинтам в одном интерфейсе.

Swagger UI доступен по адресу: `http://localhost/swagger/`

### Возможности Swagger UI:
- **Документация всех микросервисов** - полный список всех доступных эндпоинтов с описанием и примерами
- **Интерактивное тестирование** - возможность выполнять запросы прямо из интерфейса
- **Аутентификация** - поддержка JWT-токенов для тестирования защищенных эндпоинтов
- **Административный режим** - возможность тестировать эндпоинты, требующие административных прав

### Использование аутентификации в Swagger UI:

1. **Получение токена**:
   - Выполните POST запрос на `/user-api/token` с вашими учетными данными
   - Скопируйте полученный токен

2. **Авторизация**:
   - Вставьте токен в поле "JWT Token" в верхней части страницы
   - Нажмите кнопку "Authorize"

3. **Административный режим**:
   - Если у вас есть административные права, установите флажок "Admin Mode"
   - Это добавит заголовок `admin: true` ко всем запросам

## Backend API

### Endpoints

#### Products

| Метод | Эндпоинт | Описание |
| ----- | -------- | -------- |
| GET | `/api/products/list` | Получение списка всех товаров с пагинацией |
| GET | `/api/products/{product_id}` | Получение информации о конкретном товаре |
| GET | `/api/products/categories/list` | Получение списка категорий товаров |
| GET | `/api/products/by-category/{category}` | Получение товаров определенной категории с пагинацией |
| POST | `/api/products/` | Создание нового товара |
| PUT | `/api/products/{product_id}` | Обновление информации о товаре |
| DELETE | `/api/products/{product_id}` | Удаление товара |

#### System

| Метод | Эндпоинт | Описание |
| ----- | -------- | -------- |
| GET | `/api/system/health` | Проверка работоспособности системы |

## Cart API

### Endpoints

| Метод | Эндпоинт | Описание |
| ----- | -------- | -------- |
| GET | `/cart-api/cart/` | Получение корзины пользователя |
| POST | `/cart-api/cart/items` | Добавление товара в корзину |
| PUT | `/cart-api/cart/items/{item_id}` | Обновление количества товара в корзине |
| DELETE | `/cart-api/cart/items/{item_id}` | Удаление товара из корзины |
| GET | `/cart-api/cart/total` | Получение общей стоимости корзины |
| POST | `/cart-api/cart/checkout` | Оформление заказа из корзины |
| DELETE | `/cart-api/cart/` | Очистка корзины |

## Order API

### Endpoints

| Метод | Эндпоинт | Описание |
| ----- | -------- | -------- |
| GET | `/order-api/orders/` | Получение списка заказов пользователя |
| POST | `/order-api/orders/` | Создание нового заказа |
| GET | `/order-api/orders/{order_id}` | Получение информации о заказе |
| PUT | `/order-api/orders/{order_id}/status` | Обновление статуса заказа (только для администраторов) |
| PUT | `/order-api/orders/{order_id}/cancel` | Отмена заказа |
| GET | `/order-api/orders/statuses/list` | Получение списка возможных статусов заказа |

## User API

### Endpoints

| Метод | Эндпоинт | Описание |
| ----- | -------- | -------- |
| POST | `/user-api/users/register` | Регистрация нового пользователя |
| POST | `/user-api/token` | Аутентификация пользователя и получение токена |
| GET | `/user-api/users/me` | Получение информации о текущем пользователе |
| PUT | `/user-api/users/me` | Обновление информации о пользователе |
| GET | `/user-api/users/me/profile` | Получение профиля пользователя |
| GET | `/user-api/users/me/orders` | Получение списка заказов пользователя |
| GET | `/user-api/users/me/cart` | Получение корзины пользователя |
| POST | `/user-api/users/me/orders` | Оформление заказа из корзины пользователя |

## Аутентификация

Для доступа к защищенным эндпоинтам требуется JWT-токен. Получить токен можно, отправив POST-запрос на `/user-api/token` с учетными данными пользователя.

Пример запроса:

```bash
curl -X POST http://localhost/user-api/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "username=yourusername&password=yourpassword"
```

Ответ:

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR...",
  "token_type": "bearer"
}
```

Полученный токен необходимо передавать в заголовке `Authorization` в формате `Bearer <token>` для всех защищенных запросов.

## Административные функции

Некоторые эндпоинты доступны только пользователям с административными правами. Для доступа к таким эндпоинтам необходимо передавать заголовок `admin: true` в запросе.

## Коды ответов

| Код | Описание |
| --- | -------- |
| 200 | Успешно |
| 201 | Создано |
| 400 | Неверный запрос |
| 401 | Неавторизованный доступ |
| 403 | Доступ запрещен |
| 404 | Не найдено |
| 500 | Внутренняя ошибка сервера |

