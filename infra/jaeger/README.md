# üîç Jaeger Tracing Infrastructure

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jaeger –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ Product Store.

## üìã –û–±–∑–æ—Ä

Jaeger ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞. –í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ Jaeger —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –º–µ–∂–¥—É –≤—Å–µ–º–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º–∏.

# üîç Jaeger Tracing Infrastructure

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jaeger –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞ –≤ Product Store —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `jaegertracing/all-in-one`.

## üìã –û–±–∑–æ—Ä

Jaeger ‚Äî —ç—Ç–æ —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞. –í –Ω–∞—à–µ–π —Å–∏—Å—Ç–µ–º–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—Ä–∞–∑ all-in-one –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## üèóÔ∏è –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### Jaeger All-in-One
- **Collector** - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç span –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Query** - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ç—Ä–µ–π—Å–æ–≤
- **UI** - –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–π—Å–æ–≤
- **Agent** - –ª–æ–∫–∞–ª—å–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è –ø—Ä–∏–µ–º–∞ —Ç—Ä–µ–π—Å–æ–≤
- **Storage** - in-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Docker –æ–±—Ä–∞–∑
```yaml
image: jaegertracing/all-in-one:1.60
```

### –ü–æ—Ä—Ç—ã
- **16686** - Jaeger UI (–≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- **4317** - OpenTelemetry gRPC receiver
- **4318** - OpenTelemetry HTTP receiver
- **14250** - Jaeger gRPC receiver
- **14268** - Jaeger HTTP receiver
- **6831/6832** - Jaeger UDP receivers (legacy)
- **5778** - Configuration service
- **14269** - Admin/health check –∏ Prometheus –º–µ—Ç—Ä–∏–∫–∏

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```yaml
environment:
  - COLLECTOR_OTLP_ENABLED=true
  - JAEGER_DISABLED=false
  - MEMORY_MAX_TRACES=50000
  - COLLECTOR_ZIPKIN_HOST_PORT=:9411
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

–ö–∞–∂–¥—ã–π –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```bash
# Jaeger Agent –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
JAEGER_AGENT_HOST=jaeger
JAEGER_AGENT_PORT=6831

# HTTP endpoints
JAEGER_ENDPOINT=http://jaeger:14268/api/traces
OTEL_EXPORTER_JAEGER_ENDPOINT=http://jaeger:14268/api/traces
OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4318

# Service identification
OTEL_SERVICE_NAME=service-name
OTEL_RESOURCE_ATTRIBUTES=service.name=service-name,service.version=1.0.0
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Prometheus –º–µ—Ç—Ä–∏–∫–∏
Jaeger —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –Ω–∞ –ø–æ—Ä—Ç—É 14269:
- `jaeger_http_requests_total` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- `jaeger_spans_received_total` - –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ spans
- `jaeger_spans_saved_total` - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ spans
- `jaeger_query_requests_total` - –∑–∞–ø—Ä–æ—Å—ã –∫ Query API

### Grafana –¥–∞—à–±–æ—Ä–¥
–°–æ–∑–¥–∞–Ω –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Jaeger –≤ Grafana:
- HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ Jaeger UI
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ spans
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å Query API
- –†–∞–∑–º–µ—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤

## üåê –î–æ—Å—Ç—É–ø

### –ß–µ—Ä–µ–∑ Nginx (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```
http://localhost/jaeger/
```

### –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø
```
http://localhost:16686
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã
```bash
cd infra
docker-compose up -d jaeger
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```bash
# Health check
curl http://localhost:16686/

# Prometheus –º–µ—Ç—Ä–∏–∫–∏
curl http://localhost:14269/metrics
```

### 3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–µ–π—Å–æ–≤
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost/jaeger/
2. –í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å –∏–∑ —Å–ø–∏—Å–∫–∞
3. –ù–∞–∂–º–∏—Ç–µ "Find Traces"

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ç—Ä–µ–π—Å–∞

```mermaid
graph LR
    A[–ö–ª–∏–µ–Ω—Ç] --> B[Nginx]
    B --> C[Backend Service]
    C --> D[Cassandra]
    C --> E[Cart Service]
    E --> F[Order Service]
    F --> G[User Service]
    
    C -.->|span| H[Jaeger]
    E -.->|span| H
    F -.->|span| H
    G -.->|span| H
```

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–î–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≥–æ—Ç–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –∫–æ–¥–æ–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤:

1. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ OpenTelemetry** –≤ requirements.txt
2. **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ü–∏—è FastAPI** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
3. **–°–æ–∑–¥–∞–Ω–∏–µ custom spans** –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
4. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ sampling** –¥–ª—è production

## üîß –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ all-in-one –æ–±—Ä–∞–∑–∞

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è** - –æ–¥–∏–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ –≤—Å–µ–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- **–ì–æ—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ OpenTelemetry** - –≥–æ—Ç–æ–≤ –∫ –ø—Ä–∏–µ–º—É OTLP —Ç—Ä–µ–π—Å–æ–≤
- **In-memory storage** - –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏** - —ç–∫—Å–ø–æ—Ä—Ç –≤ Prometheus –∏–∑ –∫–æ—Ä–æ–±–∫–∏

## üîß –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π

Jaeger –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω –≤ –æ–±—â—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É Product Store:

- **Docker Compose** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –≤–º–µ—Å—Ç–µ —Å –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏
- **Nginx Proxy** - –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞
- **Prometheus** - —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ Jaeger
- **Grafana** - –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞
- **Health Checks** - –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
